<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="blog">
    <!-- ===================하라 시작=================== -->
 <resultMap type="blog" id="blogMap">
 	<result column="blogreadcount" property="readCount"/>
 </resultMap>
 
<insert id="insertBlog">
		insert into blog(blog_no, blog_title, member_no, blog_content, blog_date)
		values(seq_blog_no.nextval, #{blogTitle}, #{memberNo}, #{blogContent}, sysdate)
		<selectKey keyProperty = "blogNo" resultType="_int" order="AFTER">
			select seq_blog_no.currval from dual
		</selectKey>
	</insert>
	
	<insert id="insertAttachment">
		insert into attachment(attachmentno, blogno, originalfilename, renamedfilename)
		values(seq_attachmentno.nextval, #{blogNo}, #{originalFileName}, #{renamedFileName})
	</insert>
	
 	<select id="selectBlogList" resultMap="blogMap">
	select B.*
	from blog B
	order by blog_date desc
	</select>
	
	<select id="selectTotalContents" resultType="_int">
		select count(*) from blog
	</select> 

	<select id="selectOneBlog">
		select * from blog where= #{blogNo}
	</select>
	 
	 <select id="selectOneBlogCollection" resultMap="blogCollectionMap">
		select *
		from blog B left join attachment A
		        on B.blogno = A.blogno
		where B.blogno = #{blogno}
	</select> 
	
		<resultMap type="blogAttachVO" id="blogCollectionMap">
		<id column="blogno" property="blogNo"/>
		<result column="blogtitle" property="blogTitle"/>
		<result column="blogwriter" property="blogWriter"/>
		<result column="blogcontent" property="blogContent"/>
		<result column="blogdate" property="blogDate"/>
		<result column="readcount" property="readCount"/>
		<collection property="attachmentList" ofType="attachment">
			<id column="attachmentno" property="attachmentNo"/>
			<result column="blogno" property="blogNo"/>		
			<result column="originalfilename" property="originalFileName"/>		
			<result column="renamedfilename" property="renamedFileName"/>		
			<result column="uploaddate" property="uploadDate"/>		
			<result column="downloadcount" property="downloadCount"/>		
			<result column="status" property="status"/>		
		</collection>
	</resultMap>
	
	
	    <!-- ===================하라 끝=================== -->
</mapper>
